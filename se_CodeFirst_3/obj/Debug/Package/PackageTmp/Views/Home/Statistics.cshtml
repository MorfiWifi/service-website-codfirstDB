@model se_CodeFirst_3.Models.StatisticsViewModel

@{
    ViewBag.Title = "آمار و ارقام شرکت";
}

<link href="~/Plugins/MD.BootstrapPersianDateTimePicker/Content/bootstrap.css" rel="stylesheet" />
<link href="~/Plugins/MD.BootstrapPersianDateTimePicker/Content/MdBootstrapPersianDateTimePicker/jquery.Bootstrap-PersianDateTimePicker.css" rel="stylesheet" />
<script src="~/Plugins/MD.BootstrapPersianDateTimePicker/Scripts/jquery-3.1.0.js"></script>
<script src="~/Plugins/MD.BootstrapPersianDateTimePicker/Scripts/bootstrap.js"></script>
<script src="~/Plugins/MD.BootstrapPersianDateTimePicker/Scripts/MdBootstrapPersianDateTimePicker/jalaali.js"></script>
<script src="~/Plugins/MD.BootstrapPersianDateTimePicker/Scripts/MdBootstrapPersianDateTimePicker/jquery.Bootstrap-PersianDateTimePicker.js"></script>

<h2 class="page-title page-title-details"><span class="glyphicon glyphicon-list-alt"></span> @ViewBag.Title</h2>

<div ng-app="ahkSearchApp" ng-controller="ahkSearchCtrl" class="col-sm-12 table-responsive">

    <div class="col-sm-4">
        <table class="table table-hover table-bordered table-striped">
            <tr class="success">
                <th colspan="2">مشتری ها</th>
            </tr>


            <tr>
                <td>@Html.DisplayNameFor(model => model.CustomersCount)</td>
                <td><span class="badge">@Html.DisplayFor(model => model.CustomersCount)</span></td>
            </tr>


            @foreach (var item in Model.Customers)
            {
                <tr>
                    <td colspan="2">
                        <p>
                            @Html.DisplayNameFor(model => model.Customers.FirstOrDefault().CustomerName):
                            @item.CustomerName
                        </p>

                        <p>
                            @Html.DisplayNameFor(model => model.Customers.FirstOrDefault().ProductsCount):
                            <span class="badge text-success">@item.ProductsCount</span>
                        </p>
                        <p>
                            @Html.DisplayNameFor(model => model.Customers.FirstOrDefault().ProfitsGained):
                            @item.ProfitsGained
                        </p>
                    </td>
                </tr>
            }
        </table>
    </div>


    <div class="col-sm-4">
        <table class="table table-hover table-bordered table-striped">
            <tr class="success">
                <th colspan="2">تولیدکنندگان</th>
            </tr>

            <tr>
                <td>@Html.DisplayNameFor(model => model.SuppliersCount)</td>
                <td><span class="badge">@Html.DisplayFor(model => model.SuppliersCount)</span></td>
            </tr>


            @foreach (var item in Model.Suppliers)
            {
                <tr>
                    <td colspan="2">
                        <p>
                            نام شرکت:
                            @item.SupplierCompanyName
                        </p>

                        <p>
                            تعداد کالاها:
                            <span class="badge text-success">@item.ProductsCount</span>
                        </p>
                        <p>
                            پول صرف شده:
                            @item.MoneySpent
                        </p>
                    </td>
                </tr>

            }
        </table>
    </div>

    <div class="table-responsive col-sm-4">
        <table class="table table-hover table-bordered table-striped">
            <tr class="success">
                <th colspan="2">کاربران</th>
            </tr>

            <tr>
                <td>@Html.DisplayNameFor(model => model.UserCounts)</td>
                <td><span class="badge">@Html.DisplayFor(model => model.UserCounts)</span></td>
            </tr>

            <tr>
                <td>@Html.DisplayNameFor(model => model.UserSalaries)</td>
                <td>@Html.DisplayFor(model => model.UserSalaries)</td>
            </tr>
        </table>

        <table class="table table-hover table-bordered table-striped">
            <tr class="success">
                <th colspan="2">اطلاعات کلی شرکت</th>
            </tr>

            <tr>
                <td>@Html.DisplayNameFor(model => model.AllSells)</td>
                <td>@Html.DisplayFor(model => model.AllSells)</td>
            </tr>

            <tr>
                <td>@Html.DisplayNameFor(model => model.AllBuys)</td>
                <td>@Html.DisplayFor(model => model.AllBuys)</td>
            </tr>

            <tr>
                <td>@Html.DisplayNameFor(model => model.AllProfits)</td>
                <td>@Html.DisplayFor(model => model.AllProfits)</td>
            </tr>

            <tr>
                <td>@Html.DisplayNameFor(model => model.LastMonthSells)</td>
                <td>@Html.DisplayFor(model => model.LastMonthSells)</td>
            </tr>


            <tr>
                <td>@Html.DisplayNameFor(model => model.LastMonthProfitss)</td>
                <td>@Html.DisplayFor(model => model.LastMonthProfitss)</td>
            </tr>

            <tr>
                <td>@Html.DisplayNameFor(model => model.LastYearSells)</td>
                <td>@Html.DisplayFor(model => model.LastYearSells)</td>
            </tr>


            <tr>
                <td>@Html.DisplayNameFor(model => model.LastYearProfits)</td>
                <td>@Html.DisplayFor(model => model.LastYearProfits)</td>
            </tr>
            <tr>
                <td colspan="2">
                    <div class="input-group" dir="ltr" style="max-width:280px;">
                        <span class="glyphicon glyphicon-calendar input-group-addon" id="input1" data-MdDateTimePicker="true" data-TargetSelector="#input1" data-EnableTimePicker="true" data-Placement="left" data-Trigger="click"></span>
                        <input placeholder="حداقل تاریخ" class="form-control form-horizontal" type="text" name="minCustomDateFilter" ng-model="minCustomDateFilter" ng-change="ahkSearch()" onchange="callAngularMethodFromJavaScript('textBoxInputId')" id="textBoxInputId" />
                    </div>
                    <div class="input-group" dir="ltr" style="max-width:280px;">
                        <span class="glyphicon glyphicon-calendar input-group-addon" id="input2" data-MdDateTimePicker="true" data-TargetSelector="#input2" data-EnableTimePicker="true" data-Placement="left" data-Trigger="click"></span>
                        <input placeholder="حداکثر تاریخ" class="form-control form-horizontal" type="text" name="maxCustomDateFilter" ng-model="maxCustomDateFilter" ng-change="ahkSearch()" onchange="callAngularMethodFromJavaScript('textBoxInputId2')" id="textBoxInputId2" />
                    </div>
                </td>
            </tr>

            <tr>

                <td>
                    <span class="spinner loading-styles" ng-show="loading">
                        <img src="~/Content/Images/loading.gif" class="img-responsive img-rounded" alt="Loading Image" />
                    </span>

                    @Html.DisplayNameFor(model => model.CustomDateSells)
                </td>
                <td>{{customDateSells}}</td>
            </tr>

            @*<tr>
                <td>
                    @Html.DisplayNameFor(model => model.CustomDateBuys)
                </td>
                <td>{{customDateBuys}}</td>
            </tr>*@

            <tr>
                <td>
                    @Html.DisplayNameFor(model => model.CustomDateProfits)
                </td>
                <td>{{customDateBenefits}}</td>
            </tr>


        </table>
    </div>

</div>

<div class="col-sm-12" style="text-align:center;">
    @Html.ActionLink("پنل مدیریت", "Index", "Home", new { @class = "btn btn-default" })
</div>

<script>

    function callAngularMethodFromJavaScript(id) {
        angular.element(document.getElementById(id)).triggerHandler('change');
    }

    var app = angular.module('ahkSearchApp', []);
    app.controller('ahkSearchCtrl', function ($scope, $http) {

        $scope.customDateBuys = @Html.Raw(Json.Encode(Model.CustomDateBuys));
        $scope.customDateSells = @Html.Raw(Json.Encode(Model.CustomDateSells));
        $scope.customDateBenefits = @Html.Raw(Json.Encode(Model.CustomDateProfits));

        //Reset Input Data:
        $scope.resetDataInSearchFeilds = function () {
            $scope.ahkSearch();
        };

        $scope.ahkSearch = function (){
            $scope.loading = true;

            var incomingCallDTO = $.param({
                MinDate: $scope.minCustomDateFilter,
                MaxDate: $scope.maxCustomDateFilter
            });

            $http({
                url: 'Statistics?searching=true&' + incomingCallDTO,
                method: "GET",
                //data: supplier,
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' }//we have to write this code, otherwise it do not work
            })
            .then(function (response) {
                // success
                $scope.customDateBuys = response.data.CustomDateBuys;
                $scope.customDateSells =  response.data.CustomDateSells;
                $scope.customDateBenefits = response.data.CustomDateProfits;
                $scope.loading = false;
            },
            function (response) { // optional
                // failed
                $scope.loading = false;
            });
        };


    });

    $('#input1').MdPersianDateTimePicker({
        Placement: 'left',
        Trigger: 'click',
        EnableTimePicker: true,
        TargetSelector: '#textBoxInputId',
        GroupId: '',
        ToDate: false,
        FromDate: false,
        DisableBeforeToday: false,
        Disabled: false,
        Format: 'yyyy/MM/dd HH:mm:ss',
        IsGregorian: false,
        EnglishNumber: true,
    });

    $('#input2').MdPersianDateTimePicker({
        Placement: 'left',
        Trigger: 'click',
        EnableTimePicker: true,
        TargetSelector: '#textBoxInputId2',
        GroupId: '',
        ToDate: false,
        FromDate: false,
        DisableBeforeToday: false,
        Disabled: false,
        Format: 'yyyy/MM/dd HH:mm:ss',
        IsGregorian: false,
        EnglishNumber: true,
    });
</script>